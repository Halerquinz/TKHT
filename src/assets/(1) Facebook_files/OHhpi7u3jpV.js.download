;/*FB_PKG_DELIM*/

__d("MessengerWebPollConstants",[],(function(a,b,c,d,e,f){e.exports={POLL_COMPOSER_MAX_OPTIONS:10,POLL_MAX_OPTIONS:200,POLL_MIN_OPTIONS:2,POLL_MAX_OPTION_LENGTH:140,POLL_MAX_QUESTION_LENGTH:140}}),null);
__d("LSIssuePollCreationForThreadTask",["LSIssueNewTaskWithExtraOperations"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[0]=c.i64.cast([0,1]):(b=a.item,d[5]=b.syncGroup,c.i64.neq(d[5],void 0)?d[4]=d[5]:d[4]=c.i64.cast([0,1]),d[0]=d[4])})},function(e){return d[2]=new c.Map(),d[2].set("question_text",a[0]),d[2].set("thread_key",a[1]),d[2].set("options",a[2]),d[2].set("sync_group",d[0]),d[3]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTaskWithExtraOperations"),"poll_creation",c.i64.cast([0,163]),d[3],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSIssuePollCreationForThreadTaskStoredProcedure",["LSIssuePollCreationForThreadTask"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.questionText;d[1]=b.threadKey;d[2]=b.options;return c("LSIssuePollCreationForThreadTask").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("useMWCreatePoll",["LSFactory","LSIssuePollCreationForThreadTaskStoredProcedure","LSVec","emptyFunction","promiseDone","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).useCallback;function a(){var a=(h||(h=c("useReStore")))();return j(function(b,d,e,f,g){c("promiseDone")(a.runInTransaction(function(a){return c("LSIssuePollCreationForThreadTaskStoredProcedure")(c("LSFactory")(a),{options:c("LSVec").ofArray(e),questionText:d,threadKey:b})},"readwrite"),(f=f)!=null?f:c("emptyFunction"),(f=g)!=null?f:c("emptyFunction"))},[a])}g["default"]=a}),98);
__d("MWGroupPollLoggerDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MWGroupPollLogger").__setRef("MWGroupPollLoggerDeferred");function a(a,b){h.onReady(function(c){return c.log(a,b)})}g.log=a}),98);
__d("MWGroupPollThreadSubTypeCategory",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({COMMUNITY_CHATS:1,BROADCAST_CHANNELS:2,SOCIAL_CHANNELS:3,OTHERS:4});c=a;f["default"]=c}),66);
__d("MWGroupPollQPL",["LSMessagingThreadTypeUtil","MWCMIsAnyCMThread","MWLSThread","QuickPerformanceLogger","qpl","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).useCallback;function k(a){if(c("MWCMIsAnyCMThread")(a.threadType))return 1;if(d("LSMessagingThreadTypeUtil").isSocialChannel(a.threadType))return 3;return d("LSMessagingThreadTypeUtil").isDiscoverablePublicBroadcastChannel(a.threadType)?2:4}function l(a){return(a=d("MWLSThread").useThread(a,function(a){return k(a)}))!=null?a:4}function a(a){var b=l(a);return j(function(){var a={string:{poll_thread_type:String(b)}};(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(c("qpl")._(25301969,"2041"),a);h.markerStart(c("qpl")._(25301969,"2041"))},[b])}function b(a){var b=l(a);return j(function(){var a={string:{poll_thread_type:String(b)}};(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(c("qpl")._(25301969,"2041"),a);h.markerEnd(c("qpl")._(25301969,"2041"),4)},[b])}function e(a){var b=l(a);return j(function(){var a={string:{poll_thread_type:String(b)}};(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(c("qpl")._(25301969,"2041"),a);h.markerPoint(c("qpl")._(25301969,"2041"),"on_click_create_poll")},[b])}function f(a){var b=l(a);return j(function(){var a={string:{poll_thread_type:String(b)}};(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(c("qpl")._(25301969,"2041"),a);h.markerEnd(c("qpl")._(25301969,"2041"),2)},[b])}function m(a){var b=l(a);return j(function(){var a={string:{poll_thread_type:String(b)}};(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(c("qpl")._(25301969,"2041"),a);h.markerEnd(c("qpl")._(25301969,"2041"),3)},[b])}function n(a){var b=l(a);return j(function(){var a={string:{poll_thread_type:String(b)}};(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(c("qpl")._(25301816,"2042"),a);h.markerStart(c("qpl")._(25301816,"2042"))},[b])}function o(a){var b=l(a);return j(function(){var a={string:{poll_thread_type:String(b)}};(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(c("qpl")._(25301816,"2042"),a);h.markerEnd(c("qpl")._(25301816,"2042"),4)},[b])}function p(a){var b=l(a);return j(function(a,d){a={bool:{is_new_poll_option_added:a,is_vote_casted:d},string:{poll_thread_type:String(b)}};(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(c("qpl")._(25301816,"2042"),a);h.markerPoint(c("qpl")._(25301816,"2042"),"on_click_update_poll")},[b])}function q(a){var b=l(a);return j(function(){var a={string:{poll_thread_type:String(b)}};(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(c("qpl")._(25301816,"2042"),a);h.markerEnd(c("qpl")._(25301816,"2042"),3)},[b])}function r(a){var b=l(a);return j(function(){var a={string:{poll_thread_type:String(b)}};(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(c("qpl")._(25301816,"2042"),a);h.markerEnd(c("qpl")._(25301816,"2042"),2)},[b])}g.getPollThreadType=k;g.useGetPollThreadTypeWithThreadKey=l;g.useLogCreatePollStart=a;g.useLogCreatePollCancel=b;g.useLogOnCreatePollConfirmClick=e;g.useLogCreatePollSuccess=f;g.useLogCreatePollFail=m;g.useLogUpdatePollStart=n;g.useLogUpdatePollCancel=o;g.useLogOnUpdatePollConfirmClick=p;g.useLogUpdatePollFail=q;g.useLogUpdatePollSuccess=r}),98);
__d("useMWGroupNewPollSubmitErrorLogger",["I64","Int64Hooks","MWGroupPollLoggerDeferred","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return d("Int64Hooks").useCallbackInt64(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,c){yield d("MWGroupPollLoggerDeferred").log("new_poll_submit_error",{poll:{entry_point:b,exception_message:c,poll_type:void 0,question_id:void 0,thread_id:(h||(h=d("I64"))).to_string(a)}})});return function(a,b){return c.apply(this,arguments)}}(),[a])}g["default"]=a}),98);
__d("useMWGroupStartNewPollLogger",["I64","Int64Hooks","MWGroupPollLoggerDeferred","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return d("Int64Hooks").useCallbackInt64(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield d("MWGroupPollLoggerDeferred").log("start_new_poll",{poll:{entry_point:b,poll_type:void 0,question_id:void 0,thread_id:(h||(h=d("I64"))).to_string(a)}})});return function(a){return c.apply(this,arguments)}}(),[a])}g["default"]=a}),98);
__d("useMWGroupSubmitNewPollLogger",["I64","Int64Hooks","MWGroupPollLoggerDeferred","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return d("Int64Hooks").useCallbackInt64(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,c){yield d("MWGroupPollLoggerDeferred").log("submit_new_poll",{poll:{entry_point:b,options_added:c.toString(),poll_type:void 0,question_id:void 0,thread_id:(h||(h=d("I64"))).to_string(a)}})});return function(a,b){return c.apply(this,arguments)}}(),[a])}g["default"]=a}),98);
__d("LSInsertRollCallContribution",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.forEach(b.filter(b.db.table(255).fetch([[[a[0],a[1],a[2],a[3]]],"optimistic"]),function(c){return b.i64.eq(c.rollCallContributionId,a[0])&&b.i64.eq(c.rollCallId,a[1])&&c.messageId===a[2]&&b.i64.eq(c.messageTimestampMs,a[3])&&b.i64.lt(c.authorityLevel,a[23])}),function(a){return a["delete"]()})},function(c){return b.db.table(255).add({rollCallContributionId:a[0],rollCallId:a[1],messageId:a[2],messageTimestampMs:a[3],threadKey:a[4],primaryMediaUrl:a[5],primaryMediaUrlFallback:a[6],primaryMediaExpiryMs:a[7],primaryMediaWidth:a[8],primaryMediaHeight:a[9],primaryMediaMimeType:a[10],previewMediaUrl:a[11],previewMediaUrlFallback:a[12],previewMediaExpiryMs:a[13],previewMediaWidth:a[14],previewMediaHeight:a[15],previewMediaMimeType:a[16],authorityLevel:a[23],contributorId:a[17],offlineThreadingId:a[18],blurOverride:a[19],contributionSource:a[20],contributionType:a[21],content:a[22]})}])},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSLocalApplyOptimisticRollCallContribution",["LSArrayGetObjectAt","LSGetFirstAvailableAttachmentCTAID","LSGetViewerFBID","LSInsertAttachmentItem","LSInsertRollCallContribution","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return a[1]!==void 0?c.sequence([function(b){return c.db.table(250).fetch([[[c.i64.from_string(a[1]),a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(function(a){c.logger(a).mustfix(a)}("[LSMailboxLocalApplyOptimisticRollCallContributionStoredProcedure] couldn't find roll call in table roll_calls"),e=["Roll Call",c.i64.cast([0,0])],d[0]=e[0],d[1]=e[1],e):(b=a.item,e=[b.rollCallPrompt,b.expiryTimestampSec],d[0]=e[0],d[1]=e[1],e)})},function(b){return c.islc(c.sortBy(c.filter(c.db.table(255).fetch(),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.eq(b.rollCallId,c.i64.from_string(a[1]))}),[["messageTimestampMs","DESC"]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var c=a.done;a=a.value;return c?d[3]=void 0:(b=a.item,d[3]=b.messageId)})},function(b){return d[3]!==void 0?c.sequence([function(b){return d[7]=c.createArray(),c.forEach(c.islc(c.sortBy(c.db.table(18).fetch([[[a[0],d[3]]],"fk_attachments"]),[["attachmentIndex","ASC"]]),0,c.i64.to_float(c.i64.cast([0,2]))),function(a){a=a.item;return d[8]=new c.Map(),d[8].set("attachment_index",a.attachmentIndex),d[8].set("preview_url",a.previewUrl),d[8].set("preview_url_expiration_timestamp_ms",a.previewUrlExpirationTimestampMs),d[8].set("preview_url_mime_type",a.previewUrlMimeType),d[8].set("preview_width",a.previewWidth),d[8].set("preview_height",a.previewHeight),d[8].set("default_cta_id",a.defaultCtaId),d[8].set("playable_url",a.playableUrl),d[9]=(d[7].push(d[8]),d[7])})},function(a){return d[5]=d[7]}]):c.resolve((d[7]=c.createArray(),d[5]=d[7]))},function(e){return c.i64.neq(a[6],void 0)?d[6]=a[6]:d[6]=c.i64.cast([0,0]),c.i64.eq(d[6],c.i64.cast([0,0]))?(d[7]=c.i64.of_int32(a[2].length),c.i64.eq(d[7],c.i64.cast([0,1]))?c.sequence([function(b){return a[5]!==void 0?d[8]=c.i64.from_string(a[5]):d[8]=c.i64.cast([0,0]),c.localizeV2Async(c.i64.cast([0,3989800917]),void 0).then(function(a){return d[9]=a})},function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],c.i64.cast([0,0])).then(function(a){return a=a,d[10]=a[0],d[11]=a[1],a})},function(a){return c.storedProcedure(b("LSGetFirstAvailableAttachmentCTAID")).then(function(a){return a=a,d[12]=a[0],a})},function(b){return d[13]=d[10].get("offline_attachment_id"),d[10],d[14]=d[10].get("attachment_index"),d[10],c.filter(c.db.table(16).fetch([[[a[0],a[3],a[1]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&b.messageId===a[3]&&b.attachmentFbid===a[1]&&c.i64.gt(b.authorityLevel,c.i64.cast([0,20]))}).next().then(function(b){var e=b.done;b.value;return e?c.db.table(16).put({threadKey:a[0],messageId:a[3],attachmentFbid:a[1],timestampMs:a[4],offlineAttachmentId:d[13],attachmentType:c.i64.cast([0,7]),filesize:c.i64.cast([0,0]),attachmentCta1Id:d[12],attachmentIndex:d[14],hasMedia:!1,hasXma:!0,isSharable:!1,xmaLayoutType:c.i64.cast([0,10]),cta1Title:d[9],cta1Type:"xma_disabled_cta",defaultCtaTitle:d[9],defaultCtaType:"xma_disabled_cta",defaultCtaId:d[12],titleText:d[0],authorityLevel:c.i64.cast([0,20]),countdownTimestampMs:c.i64.mul(d[1],c.i64.cast([0,1e3])),maxTitleNumOfLines:c.i64.cast([0,4])}):0})},function(a){return d[15]=d[10].get("preview_url"),d[10],d[26]=d[15]==null?"":d[15],d[16]=d[10].get("preview_url_mime_type"),d[10],d[27]=d[16]==null?"":d[16],d[17]=d[10].get("preview_height"),d[10],d[23]=d[17]==null?c.i64.cast([0,0]):d[17],d[18]=d[10].get("preview_width"),d[10],d[22]=d[18]==null?c.i64.cast([0,0]):d[18],d[19]=d[10].get("playable_url"),d[10],d[25]=d[19]==null?"":d[19],d[20]=d[10].get("playable_url_mime_type"),d[10],c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[21]=a[0],a})},function(e){return c.storedProcedure(b("LSInsertRollCallContribution"),c.i64.cast([0,0]),c.i64.from_string(a[1]),a[3],a[4],a[0],d[25],"",c.i64.cast([0,0]),d[22],d[23],d[20]==null?"":d[20],d[26],"",c.i64.cast([0,0]),d[22],d[23],d[27],d[21],a[3],!1,d[8],a[6],void 0,c.i64.cast([0,20]))},function(b){return c.forEach(c.db.table(250).fetch([[[c.i64.from_string(a[1]),a[0]]]]),function(a){var b=a.update;a.item;return b({isBlurred:!1,viewerHasContributed:!0})})},function(e){return d[24]=d[10].get("attachment_index"),d[10],c.storedProcedure(b("LSInsertAttachmentItem"),a[1],d[24],a[0],c.i64.cast([0,0]),a[3],void 0,c.i64.cast([0,0]),void 0,void 0,void 0,void 0,void 0,d[25],void 0,void 0,void 0,void 0,d[26],d[26],c.i64.cast([0,0]),d[27],d[22],d[23],void 0,d[12],d[9],"xma_disabled_cta",void 0,void 0,void 0,!1,"full",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)},function(e){return d[28]=c.i64.of_int32(d[5].length),c.i64.gt(d[28],c.i64.cast([0,0]))?c.loopAsync(d[28],function(e){return d[29]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[5],d[29]).then(function(a){return a=a,d[30]=a[0],d[31]=a[1],a})},function(e){return d[32]=d[30].get("attachment_index"),d[30],d[33]=d[30].get("preview_url"),d[30],d[34]=d[30].get("preview_url_expiration_timestamp_ms"),d[30],d[35]=d[30].get("preview_url_mime_type"),d[30],d[36]=d[30].get("preview_width"),d[30],d[37]=d[30].get("preview_height"),d[30],d[38]=d[30].get("default_cta_id"),d[30],d[39]=d[30].get("playable_url"),d[30],c.storedProcedure(b("LSInsertAttachmentItem"),a[1],c.i64.add(d[32],c.i64.cast([0,1])),a[0],c.i64.cast([0,0]),a[3],void 0,c.i64.cast([0,0]),void 0,void 0,void 0,void 0,void 0,d[39],void 0,void 0,void 0,void 0,d[33],d[33],d[34],d[35],d[36],d[37],void 0,d[38],d[9],"xma_disabled_cta",void 0,void 0,void 0,!1,"full",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}])}):c.resolve()}]):c.resolve((d[8]=c.i64.of_int32(a[2].length),function(a){c.logger(a).mustfix(a)}(["[LSMailboxLocalApplyOptimisticRollCallContributionStoredProcedure] expected only 1 attachment for MEDIA contribution, but found ",c.i64.to_string(d[8])].join(""))))):c.i64.eq(d[6],c.i64.cast([0,1]))?a[7]!==void 0?(d[7]=new c.Map(),d[7].set("roll_call_id",c.i64.from_string(a[1])),d[7].set("contribution_type",d[6]),d[7].set("content",a[7]),d[7].set("offline_threading_id",a[3]),d[8]=d[7].get("roll_call_id"),d[7],d[9]=c.toJSON(d[7]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[8]),c.i64.cast([0,610]),d[9],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.resolve(function(a){c.logger(a).mustfix(a)}("[LSMailboxLocalApplyOptimisticRollCallContributionStoredProcedure] expected non-null content for TEXT contribution, but found null")):c.resolve(c.i64.eq(d[6],c.i64.cast([0,2]))?function(a){c.logger(a).mustfix(a)}("[LSMailboxLocalApplyOptimisticRollCallContributionStoredProcedure] LINK contributions are not yet supported"):0)}]):c.resolve(function(a){c.logger(a).mustfix(a)}("[LSMailboxLocalApplyOptimisticRollCallContributionStoredProcedure] param product_fbid is missing"))},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSLocalApplyOptimisticSharedAlbumContribution",["LSArrayGetObjectAt","LSArrayRemoveObjectAt","LSCollapseAttachments","LSGetFirstAvailableAttachmentCTAID","LSInsertAttachmentItem"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.localizeV2Async(c.i64.cast([0,2856734260]),void 0).then(function(a){return d[0]=a})},function(a){return c.storedProcedure(b("LSGetFirstAvailableAttachmentCTAID")).then(function(a){return a=a,d[1]=a[0],a})},function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],c.i64.cast([0,0])).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(e){return d[4]=c.i64.random(),d[5]=c.i64.to_string(d[4]),a[1]!==void 0?c.sequence([function(b){return c.db.table(279).fetch([[[c.i64.from_string(a[1]),a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(function(a){c.logger(a).mustfix(a)}("[LSMailboxLocalApplyOptimisticSharedAlbumContributionStoredProcedure] couldn't find album in table shared_albums"),d[6]="Shared Album"):(b=a.item,d[6]=b.title)})},function(b){return d[8]=d[2].get("offline_attachment_id"),d[2],d[9]=d[2].get("attachment_index"),d[2],c.filter(c.db.table(16).fetch([[[a[0],a[3],d[5]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&b.messageId===a[3]&&b.attachmentFbid===d[5]&&c.i64.gt(b.authorityLevel,c.i64.cast([0,20]))}).next().then(function(b){var e=b.done;b.value;return e?c.db.table(16).put({threadKey:a[0],messageId:a[3],attachmentFbid:d[5],timestampMs:a[4],offlineAttachmentId:d[8],attachmentType:c.i64.cast([0,7]),filesize:c.i64.cast([0,0]),attachmentCta1Id:d[1],attachmentIndex:d[9],hasMedia:!1,hasXma:!0,isSharable:!1,xmaLayoutType:c.i64.cast([0,10]),cta1Title:d[0],cta1Type:"xma_disabled_cta",defaultCtaTitle:d[0],defaultCtaType:"xma_shared_album_viewer",defaultCtaId:d[1],titleText:d[6],authorityLevel:c.i64.cast([0,20]),maxTitleNumOfLines:c.i64.cast([0,4]),collapsibleId:c.i64.from_string(a[1])}):0})},function(d){return c.storedProcedure(b("LSCollapseAttachments"),a[0],c.i64.from_string(a[1]))},function(e){return d[10]=c.i64.of_int32(a[2].length),c.i64.gt(d[10],c.i64.cast([0,0]))?c.loopAsync(d[10],function(e){return d[12]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],d[12]).then(function(a){return a=a,d[13]=a[0],d[14]=a[1],a})},function(b){return d[15]=d[13].get("preview_url"),d[13],d[23]=d[15]==null?"":d[15],d[16]=d[13].get("preview_height"),d[13],d[24]=d[16]==null?c.i64.cast([0,0]):d[16],d[17]=d[13].get("preview_width"),d[13],d[25]=d[17]==null?c.i64.cast([0,0]):d[17],d[18]=d[13].get("preview_url_mime_type"),d[13],d[19]=d[13].get("playable_url"),d[13],d[20]=d[13].get("playable_url_mime_type"),d[13],d[21]=d[13].get("preview_url_mime_type"),d[13],d[22]=d[13].get("offline_attachment_id"),d[13],d[22]!==void 0?c.sequence([function(b){return d[27]="",d[28]=c.i64.from_string(d[22]),d[29]=c.i64.from_string(a[1]),d[26]=c.i64.of_float(Date.now()),c.forEach(c.filter(c.db.table(280).fetch([[[d[29],d[28],a[0],d[27]]]]),function(b){return c.i64.eq(b.sharedAlbumId,d[29])&&c.i64.eq(b.sharedAlbumContributionId,d[28])&&c.i64.eq(b.threadKey,a[0])&&b.messageId===d[27]&&c.i64.lt(b.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(b){return c.db.table(280).add({messageId:d[27],sharedAlbumContributionId:d[28],sharedAlbumId:d[29],threadKey:a[0],mediaUrl:d[19]==null?d[23]:d[19],mediaHeight:d[24],mediaWidth:d[25],mediaUrlFallback:"",urlExpiryMs:c.i64.cast([0,0]),creationTimestampMs:d[26],authorityLevel:c.i64.cast([0,20]),previewMediaUrl:d[23],previewMediaHeight:d[24],previewMediaWidth:d[25],previewMediaMimeType:d[18]==null?"":d[18]})}]):c.resolve(function(a){c.logger(a).mustfix(a)}("[LSMailboxLocalApplyOptimisticSharedAlbumContributionStoredProcedure] param $attachment_otid is missing"))}])}):c.resolve()},function(e){return d[11]=c.createArray(),d[12]=(d[11].push(c.i64.cast([0,0])),d[11]),c.forEach(c.islc(c.sortBy(c.db.table(280).fetch([[[c.i64.from_string(a[1])]]]),[["creationTimestampMs","DESC"]]),0,c.i64.to_float(c.i64.cast([0,4]))),function(e){var f=e.item;return c.sequence([function(a){return d[15]=f.previewMediaUrl,c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[11],c.i64.cast([0,0])).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(e){return c.i64.eq(c.i64.cast([0,0]),d[12])?d[14]=d[6]:d[14]=void 0,c.storedProcedure(b("LSInsertAttachmentItem"),d[5],d[12],a[0],c.i64.cast([0,0]),a[3],void 0,c.i64.cast([0,0]),void 0,d[14],void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,d[15],d[15],c.i64.cast([0,0]),f.previewMediaMimeType,f.mediaWidth,f.mediaHeight,void 0,d[1],void 0,"xma_shared_album_viewer",void 0,void 0,void 0,!1,"full",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)},function(a){return c.nativeTypeOperation("Array",b("LSArrayRemoveObjectAt"),d[11],c.i64.cast([0,0])).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]=(d[11].push(c.i64.add(d[12],c.i64.cast([0,1]))),d[11])}])})}]):c.resolve(function(a){c.logger(a).mustfix(a)}("[LSMailboxLocalApplyOptimisticSharedAlbumContributionStoredProcedure] param product_fbid is missing"))}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSLocalApplyOptimisticMessageWithAttachmentsV2",["LSArrayGetObjectAt","LSLocalApplyOptimisticMessageV2","LSLocalApplyOptimisticRollCallContribution","LSLocalApplyOptimisticSharedAlbumContribution","LSSetMessageDisplayedContentTypes"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.storedProcedure(b("LSLocalApplyOptimisticMessageV2"),a[0],a[1],a[2],a[3],a[4],a[5],void 0).then(function(a){return a=a,d[0]=a[0],d[1]=a[1],a})},function(e){return d[2]=a[5].get("attachments"),a[5],d[3]=a[5].get("product_type"),a[5],d[3]==="roll_call"?(d[4]=a[5].get("product_fbid"),a[5],d[5]=a[5].get("product_attribution"),a[5],d[6]=a[5].get("contribution_type"),a[5],c.storedProcedure(b("LSLocalApplyOptimisticRollCallContribution"),a[1],d[4],d[2],d[0],d[1],d[5],d[6],a[3])):d[3]==="shared_albums"?(d[4]=a[5].get("product_fbid"),a[5],d[5]=a[5].get("product_attribution"),a[5],c.storedProcedure(b("LSLocalApplyOptimisticSharedAlbumContribution"),a[1],d[4],d[2],d[0],d[1],d[5])):(d[4]=c.i64.of_int32(d[2].length),c.i64.gt(d[4],c.i64.cast([0,0]))?c.loopAsync(d[4],function(e){return d[5]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[2],d[5]).then(function(a){return a=a,d[6]=a[0],d[7]=a[1],a})},function(b){return d[8]=d[6].get("attachment_fbid"),d[6],d[9]=d[6].get("offline_attachment_id"),d[6],d[10]=d[6].get("attachment_type"),d[6],d[11]=d[6].get("filename"),d[6],d[12]=d[6].get("filesize"),d[6],d[13]=d[6].get("attachment_index"),d[6],d[14]=d[6].get("has_media"),d[6],d[15]=d[6].get("has_xma"),d[6],d[16]=d[6].get("playable_url"),d[6],d[17]=d[6].get("playable_url_mime_type"),d[6],d[18]=d[6].get("playable_duration_ms"),d[6],d[19]=d[6].get("preview_url"),d[6],d[20]=d[6].get("preview_url_mime_type"),d[6],d[21]=d[6].get("mini_preview"),d[6],d[22]=d[6].get("preview_width"),d[6],d[23]=d[6].get("preview_height"),d[6],d[24]=d[6].get("xma_layout_type"),d[6],d[25]=d[6].get("xmas_template_type"),d[6],d[26]=d[6].get("cta1_title"),d[6],d[27]=d[6].get("cta2_title"),d[6],d[28]=d[6].get("cta3_title"),d[6],d[29]=d[6].get("image_url"),d[6],d[30]=d[6].get("action_url"),d[6],d[31]=d[6].get("title_text"),d[6],d[32]=d[6].get("subtitle_text"),d[6],d[33]=d[6].get("description_text"),d[6],d[34]=d[6].get("source_text"),d[6],d[35]=d[6].get("original_file_hash"),d[6],d[36]=d[6].get("sound_bite_client_sound_key"),d[6],d[37]=d[6].get("sound_bite_visual"),d[6],d[38]=d[6].get("ephemeral_media_state"),d[6],d[39]=d[6].get("waveform_data"),d[6],d[40]=d[6].get("avatar_audio_message_animated_url"),d[6],d[41]=d[6].get("avatar_audio_message_idle_url"),d[6],d[42]=d[6].get("avatar_audio_message_animated_b_url"),d[6],d[43]=d[6].get("avatar_audio_message_idle_b_url"),d[6],d[44]=d[6].get("avatar_audio_message_background_graphics_image_url"),d[6],d[45]=d[6].get("avatar_audio_message_pose_id"),d[6],d[46]=d[6].get("sampling_frequency_hz"),d[6],d[47]=d[6].get("should_autoplay_video"),d[6],c.filter(c.db.table(16).fetch([[[a[1],d[0],d[8]]]]),function(b){return c.i64.eq(b.threadKey,a[1])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&b.messageId===d[0]&&b.attachmentFbid===d[8]&&c.i64.gt(b.authorityLevel,c.i64.cast([0,20]))}).next().then(function(b){var e=b.done;b.value;return e?c.db.table(16).put({threadKey:a[1],messageId:d[0],attachmentFbid:d[8],timestampMs:d[1],offlineAttachmentId:d[9],attachmentType:d[10],filename:d[11],filesize:d[12],attachmentIndex:d[13],hasMedia:d[14],hasXma:d[15],isSharable:!1,playableUrl:d[16],playableUrlMimeType:d[17],playableDurationMs:d[18],previewUrl:d[19],previewUrlMimeType:d[20],miniPreview:d[21],previewWidth:d[22],previewHeight:d[23],xmaLayoutType:d[24],xmasTemplateType:d[25],cta1Title:d[26],cta2Title:d[27],cta3Title:d[28],imageUrl:d[29],actionUrl:d[30],titleText:d[31],subtitleText:d[32],descriptionText:d[33],sourceText:d[34],ephemeralMediaState:d[38],waveformData:d[39],samplingFrequencyHz:d[46],originalFileHash:d[35],authorityLevel:c.i64.cast([0,20]),shouldAutoplayVideo:d[47]}):0})}])}):c.resolve())},function(e){return d[4]=c.i64.of_int32(d[2].length),c.i64.gt(d[4],c.i64.cast([0,0]))?(d[5]=a[5].get("sticker_id"),a[5],c.storedProcedure(b("LSSetMessageDisplayedContentTypes"),a[1],d[0],d[1],a[3],!1,c.i64.neq(d[5],void 0))):c.resolve()},function(a){return a=[d[0],d[1]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure",["LSLocalApplyOptimisticMessageWithAttachmentsV2"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.senderId;d[1]=b.threadKey;d[2]=b.threadType;d[3]=b.text;d[4]=b.snippet;d[5]=b.extraSendMessageParams;return c("LSLocalApplyOptimisticMessageWithAttachmentsV2").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSOptimisticContributeToTextPrompt",["LSLocalApplyOptimisticMessageV2","LSLocalApplyOptimisticRollCallContribution"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.createArray(),d[1]=new c.Map(),d[1].set("snippet_has_emoji",void 0),d[1].set("sticker_id",void 0),d[1].set("sticker_alt_text",void 0),d[1].set("hot_emoji_size",void 0),d[1].set("external_attachment_url",void 0),d[1].set("attribution_app_id",void 0),d[1].set("source",c.i64.cast([0,0])),d[1].set("platform_ref",void 0),d[1].set("platform_token",void 0),d[1].set("reply_source_id",void 0),d[1].set("reply_source_type",void 0),d[1].set("reply_source_type_v2",void 0),d[1].set("mention_data",void 0),d[1].set("mark_read",void 0),d[1].set("calculate_denormalizations",void 0),d[1].set("optimistic_attachment_preview",void 0),d[1].set("initiating_app_id",void 0),d[1].set("initiating_source",void 0),d[1].set("power_up_style",c.i64.cast([0,0])),d[1].set("data_trace_id",void 0),d[1].set("attachments",d[0]),d[1].set("should_copy_attachments",!1),d[1].set("magic_words_data",void 0),d[1].set("local_data_id",void 0),d[1].set("reply_type",void 0),d[1].set("dety_params",void 0),d[1].set("product_type","roll_call"),d[1].set("product_fbid",a[2]),d[1].set("product_attribution",a[3]),c.storedProcedure(b("LSLocalApplyOptimisticMessageV2"),a[1],a[0],c.i64.cast([0,18]),a[4],a[4],d[1],void 0).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(e){return d[4]=c.createArray(),c.storedProcedure(b("LSLocalApplyOptimisticRollCallContribution"),a[0],a[2],d[4],d[2],d[3],a[3],c.i64.cast([0,1]),a[4])}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSOptimisticContributeToTextPromptStoredProcedure",["LSOptimisticContributeToTextPrompt"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;d[1]=b.senderId;d[2]=b.promptId;d[3]=b.productAttribution;d[4]=b.text;return c("LSOptimisticContributeToTextPrompt").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSOptimisticCreateRollCall",["LSCreateOfflineThreadingID","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSCreateOfflineThreadingID"),d[0]).then(function(a){return a=a,d[1]=a[0],a})},function(b){return c.forEach(c.filter(c.db.table(250).fetch([[[d[1],a[0]]]]),function(b){return c.i64.eq(b.rollCallId,d[1])&&c.i64.eq(b.threadKey,a[0])&&c.i64.lt(b.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(b){return c.db.table(250).add({rollCallId:d[1],threadKey:a[0],rollCallPrompt:a[1],expiryTimestampSec:c.i64.cast([0,0]),isBlurred:!1,authorityLevel:c.i64.cast([0,20]),offlineThreadingId:d[1],canViewWithoutContributing:!1})},function(e){return d[2]=new c.Map(),d[2].set("thread_key",a[0]),d[2].set("prompt",a[1]),d[2].set("offline_threading_id",d[1]),d[2].set("prompt_type",a[2]),d[3]=d[2].get("thread_key"),d[2],d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[3]),c.i64.cast([0,607]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return a=[d[1],d[0]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSOptimisticCreateRollCallStoredProcedure",["LSOptimisticCreateRollCall"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;d[1]=b.prompt;d[2]=b.promptType;return c("LSOptimisticCreateRollCall").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("RollCallContributionType",[],(function(a,b,c,d,e,f){a=Object.freeze({MEDIA:0,TEXT:1,LINK:2});f["default"]=a}),66);
__d("RollCallPromptType",[],(function(a,b,c,d,e,f){a=Object.freeze({MEDIA:0,TEXT:1,LINK:2});f["default"]=a}),66);
__d("MWPromptCreationUtils",["I64","LSAuthorityLevel","LSFactory","LSIntEnum","LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure","LSMessagingThreadAttributionType","LSOptimisticContributeToTextPromptStoredProcedure","LSOptimisticCreateRollCallStoredProcedure","LSShape","LSVec","MWXMAAttachmentSharedStackConstants","MessagingAttachmentType","OfflineThreadingId","Promise","ReQL","RollCallContributionType","RollCallPromptType","XComposerPhotoUploader"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,e,f,g){return new(j||(j=b("Promise")))(function(b,j){a.runInTransaction(function(a){return c("LSOptimisticCreateRollCallStoredProcedure")(c("LSFactory")(a),{prompt:f,promptType:(h||(h=d("LSIntEnum"))).ofNumber(g),threadKey:e})},"readwrite").then(function(e){var f=e[0],g=d("ReQL").fromTableAscending(a.tables.roll_calls).subscribe(function(a,e){if(e.operation==="add"||e.operation==="put"){a=e.value.offlineThreadingId;var h=(i||(i=d("I64"))).to_int32(e.value.authorityLevel)>=c("LSAuthorityLevel").AUTHORITATIVE;h&&a!=null&&(i||(i=d("I64"))).equal(a,f)&&(g(),b(e.value.rollCallId))}})})["catch"](function(a){j(a)})})}function k(a,b,e,f,g){return a.runInTransaction(function(a){return c("LSOptimisticContributeToTextPromptStoredProcedure")(c("LSFactory")(a),{productAttribution:String(c("LSMessagingThreadAttributionType").ROLLCALL),promptId:(i||(i=d("I64"))).to_string(f),senderId:b,text:(a=g)!=null?a:"",threadKey:e})},"readwrite")}function l(a,b,e,f,g,j,k,l){var m,n=d("OfflineThreadingId").createOfflineThreadingID(),o=(m=l==null?void 0:l.startsWith("video/"))!=null?m:!1;return a.runInTransaction(function(a){return c("LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure")(c("LSFactory")(a),{extraSendMessageParams:d("LSShape").ofRecord({attachments:c("LSVec").ofArray([d("LSShape").ofRecord({attachment_fbid:n,attachment_index:(i||(i=d("I64"))).zero,attachment_type:(h||(h=d("LSIntEnum"))).ofNumber(o?c("MessagingAttachmentType").VIDEO:c("MessagingAttachmentType").IMAGE),has_media:!0,has_xma:!0,offline_attachment_id:n,playable_url:o?k:void 0,preview_height:i.of_float(d("MWXMAAttachmentSharedStackConstants").STACK_ITEM_HEIGHT),preview_url:o?void 0:k,preview_url_mime_type:o?void 0:l,preview_width:i.of_float(d("MWXMAAttachmentSharedStackConstants").STACK_ITEM_WIDTH)})]),contribution_type:h.ofNumber(c("RollCallContributionType").MEDIA),product_fbid:i.to_string(g),product_type:"roll_call",source:h.ofNumber(c("LSMessagingThreadAttributionType").ROLLCALL)}),senderId:b,text:j,threadKey:e,threadType:f})},"readwrite").then(function(a){a=a[0];return a})}function e(a,d,e,f,g,h,i,m,n){switch(i){case c("RollCallPromptType").MEDIA:return l(a,d,e,f,g,h,m,n);case c("RollCallPromptType").TEXT:return k(a,d,e,g,h);default:return(j||(j=b("Promise"))).reject()}}function f(a,b,e,f){var g=d("OfflineThreadingId").createOfflineThreadingID();a=a;a.uploadID=g;var h=new(c("XComposerPhotoUploader"))({onUploadFailure:function(a,b){},onUploadSuccess:function(a,b){},uploadEndpoint:"/messenger/upload_roll_call/"});h.getAsyncFileUploadRequest([a],[g],{data:{message_otid:e,roll_call_id:(i||(i=d("I64"))).to_string(b),thread_id:f}}).send()}g.createAuthoritiativeRollCall=a;g.createOptimisticRollCallMessage=e;g.startRollCallMediaUpload=f}),98);
__d("ScreenDualPlusFilled24.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs("svg",babelHelpers["extends"]({viewBox:"0 0 24 24",width:"1em",height:"1em",fill:"currentColor"},a,{children:[a.title!=null&&i.jsx("title",{children:a.title}),a.children!=null&&i.jsx("defs",{children:a.children}),i.jsxs("g",{stroke:"none",strokeWidth:1,fillRule:"evenodd",children:[i.jsx("path",{d:"M95.5 8a1.001 1.001 0 0 0 0-2 1.001 1.001 0 0 0 0 2",transform:"translate(-444 -156) translate(354.5 156)"}),i.jsx("path",{d:"M108.5 15.75h-2.25V18a.75.75 0 0 1-1.5 0v-2.25h-2.25a.75.75 0 0 1 0-1.5h2.25V12a.75.75 0 0 1 1.5 0v2.25h2.25a.75.75 0 0 1 0 1.5zm-15.75.75a.75.75 0 0 1-.75-.75V2.25a.75.75 0 0 1 .75-.75h9.5a.75.75 0 0 1 .75.75V6h-2.25c-1.24 0-2.25 1.01-2.25 2.25v3.117a2.261 2.261 0 0 1-.75.133h-.001c-1.058 0-2.002-.777-2.302-1.528a.75.75 0 0 0-1.394.556C94.546 11.758 95.972 13 97.75 13h.002c.257 0 .507-.03.749-.08v3.58h-5.75zM110.25 6h-5.75V2.25c0-1.24-1.01-2.25-2.25-2.25h-9.5c-1.24 0-2.25 1.01-2.25 2.25v13.5c0 1.24 1.01 2.25 2.25 2.25h5.75v3.75c0 1.24 1.01 2.25 2.25 2.25h9.5c1.24 0 2.25-1.01 2.25-2.25V8.25c0-1.24-1.01-2.25-2.25-2.25z",transform:"translate(-444 -156) translate(354.5 156)"})]})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("MWChatPollStrings",["fbt"],(function(a,b,c,d,e,f,g,h){"use strict";a={addPollOptionLabel:h._("__JHASH__TTumxStOaLR__JHASH__"),createPollLabel:h._("__JHASH__Tf8o14f91uW__JHASH__"),pollTitleLabel:h._("__JHASH__CotUus5yWVx__JHASH__")};b=a;g["default"]=b}),98);
__d("MWXIconRollCall",["MWXSvgIcon","SVGIcon","cr:8280","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgIcon(d("SVGIcon").svgIcon(b("cr:8280")),c("gkx")("23219"));g["default"]=a}),98);
;/*FB_PKG_DELIM*/

__d("DeletionType.react",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({Global:0,Local:1});c=a;f["default"]=c}),66);
__d("LSOptimisticUnsendMessage",["LSIssueNewTaskWithExtraOperations"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("message_id",a[0]),d[0].set("thread_key",a[1]),d[1]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTaskWithExtraOperations"),"unsend_message",c.i64.cast([0,33]),d[1],void 0,void 0,a[2]==null?c.i64.cast([0,0]):a[2],c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSOptimisticUnsendMessageStoredProcedure",["LSOptimisticUnsendMessage"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.messageId;d[1]=b.threadKey;d[2]=b.pluginType;return c("LSOptimisticUnsendMessage").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("useMWV2GlobalRemoveMessage",["LSFactory","LSOptimisticUnsendMessageStoredProcedure","LSPlatformWaitForTaskCompletion","MWV2LogMessageClick","MessengerWebUXLogger","QPLUserFlow","Random","WebUserFlowLoggingDataContextProvider.react","qpl","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;b=i||d("react");var j=b.useCallback,k=b.useContext;function a(a){var b=(h||(h=c("useReStore")))(),e=k(d("WebUserFlowLoggingDataContextProvider.react").WebUserFlowLoggingDataContext),f=e.loggingDataRef,g=c("MessengerWebUXLogger").useInteractionLogger();return j(function(e){d("MWV2LogMessageClick").log(b,e,47);var h=c("qpl")._(25308285,"2002"),i=Date.now()+(Math.round(d("Random").random()*1e4)+1e4);c("QPLUserFlow").start(h,{annotations:{string:{isEphemeralMessage:e.ephemeralDurationInSec!=null||e.ephemeralExpirationTs!=null?"true":"false",type:"openUnsendMessage"}},instanceKey:i});return c("LSPlatformWaitForTaskCompletion")(b,function(b){return c("LSOptimisticUnsendMessageStoredProcedure")(c("LSFactory")(b),{messageId:e.messageId,pluginType:a,threadKey:e.threadKey})},"optimisticUnsendMessage").then(function(){g==null?void 0:g(babelHelpers["extends"]({},f.current,{eventName:"message_remove_success",eventType:"backend"})),c("QPLUserFlow").endSuccess(h,{instanceKey:i})})["catch"](function(a){return g==null?void 0:g(babelHelpers["extends"]({},f.current,{eventName:"message_remove_failure",eventType:"backend",extraData:babelHelpers["extends"]({},f.current.extraData,{error:a.toString()})}))})},[b,g,f,a])}g["default"]=a}),98);
__d("LSTaskType",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["BatchLookup","CreateThread","DeleteMessage","DeviceRegistration","DisableDevice","EnableDevice","MessageRangeQuery","PreKeyUpload","SendMessage","SendOrRemoveReaction","UnsendMessage","VerifyThreadChecksum"]);c=a;f["default"]=c}),66);
__d("LSTasks",["FBLogger","I64","LSIntEnum","LSJson","LSPendingTasksPluginType","LSTaskType"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){switch(a){case c("LSTaskType").BatchLookup:return"10003";case c("LSTaskType").CreateThread:return"10002";case c("LSTaskType").DeleteMessage:return"155";case c("LSTaskType").DeviceRegistration:return"10001";case c("LSTaskType").DisableDevice:return"10007";case c("LSTaskType").EnableDevice:return"10006";case c("LSTaskType").MessageRangeQuery:return"14";case c("LSTaskType").PreKeyUpload:return"10004";case c("LSTaskType").SendMessage:return"10005";case c("LSTaskType").SendOrRemoveReaction:return"29";case c("LSTaskType").UnsendMessage:return"33";case c("LSTaskType").VerifyThreadChecksum:throw c("FBLogger")("mpf_web_foundations").mustfixThrow("Not a supported task type.")}}function a(a,b,e,f){return a.table("pending_tasks").add({context:j(b),dataTraceId:void 0,enqueueTimestampMs:(h||(h=d("I64"))).of_float(Date.now()),failureCount:h.zero,firstExecutedTimestampMs:h.zero,httpUrlOverride:void 0,initTraceTimestampMs:void 0,minTimeToSyncTimestampMs:h.zero,pluginType:(i||(i=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").LS_BROKER),priority:h.zero,queueName:e,syncGroupId:void 0,taskValue:d("LSJson").stringify(f),timeoutTimestampMs:void 0})}g.enqueue=a}),98);
__d("useMWV2LocalRemoveMessage",["I64","LSDict","LSIntEnum","LSTaskType","LSTasks","MWV2LogMessageClick","MessengerWebUXLogger","QPLUserFlow","Random","WebUserFlowLoggingDataContextProvider.react","promiseDone","qpl","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");var l=b.useCallback,m=b.useContext;function a(){var a=(h||(h=c("useReStore")))(),b=m(d("WebUserFlowLoggingDataContextProvider.react").WebUserFlowLoggingDataContext),e=b.loggingDataRef,f=c("MessengerWebUXLogger").useInteractionLogger();return l(function(b){var g=c("qpl")._(25308285,"2002"),h=Date.now()+(Math.round(d("Random").random()*1e4)+1e4);c("QPLUserFlow").start(g,{annotations:{string:{isEphemeralMessage:b.ephemeralDurationInSec!=null||b.ephemeralExpirationTs!=null?"true":"false",type:"openDeleteMessageForMe"}},instanceKey:h});d("MWV2LogMessageClick").log(a,b,46);c("promiseDone")(a.runInTransaction(function(a){return d("LSTasks").enqueue(a,c("LSTaskType").DeleteMessage,(i||(i=d("I64"))).to_string((j||(j=d("LSIntEnum"))).ofNumber(155)),new(c("LSDict"))([["message_id",b.messageId],["thread_key",b.threadKey]])).then(function(){f==null?void 0:f(babelHelpers["extends"]({},e.current,{eventName:"message_remove_success",eventType:"backend"})),c("QPLUserFlow").endSuccess(g,{instanceKey:h})})["catch"](function(a){return f==null?void 0:f(babelHelpers["extends"]({},e.current,{eventName:"message_remove_failure",eventType:"backend",extraData:babelHelpers["extends"]({},e.current.extraData,{error:a.toString()})}))})},"readwrite"))},[a,f,e])}g["default"]=a}),98);
__d("MWV2GlobalRemoveMessageDialog.react",["fbt","DeletionType.react","I64","LSContactBitOffset","LSMessagingThreadTypeUtil","MWDialogText.react","MWPActor.react","MWXCardedDialog.react","MWXDialogPageLegacy.react","MWXMultiStepDialog.react","MWXRadio.react","MessengerWebUXLogger","ReQL","ReQLSuspense","WebUserFlowLoggingDataContextProvider.react","cr:6987","cr:6988","gkx","promiseDone","react","useMWV2GlobalRemoveMessage","useMWV2LocalRemoveMessage","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=k||(k=d("react"));e=k;var m=e.useContext,n=e.useState,o=b("cr:6987")==null?function(a){return function(a){}}:b("cr:6987");e=function(){return function(a){}};var p=b("cr:6988")||e;function a(a){var b=a.learnMoreOnMessageRemove,e=a.message,g=a.onClose,k=a.removeLogger,q=a.threadType,r=(i||(i=c("useReStore")))();a=m(d("WebUserFlowLoggingDataContextProvider.react").WebUserFlowLoggingDataContext);var s=a.loggingDataRef;a=c("MessengerWebUXLogger").useImpressionLoggerRef(babelHelpers["extends"]({},s.current,{eventName:"message_remove_sheet_rendered"}));var t=c("MessengerWebUXLogger").useInteractionLogger(),u=d("LSMessagingThreadTypeUtil").isSecure(q),v=o(q),w=p(),x=c("useMWV2LocalRemoveMessage")(),y=c("useMWV2GlobalRemoveMessage")(),z=u?w:x,A=u?v:function(a){return c("promiseDone")(y(a))};w=u?h._("__JHASH__mgfzRCe5bWP__JHASH__"):h._("__JHASH__3nC2F2SOFIl__JHASH__");x=c("gkx")("24122")?h._("__JHASH__oBth3b5GmEf__JHASH__"):h._("__JHASH__uQdYnP4xNl0__JHASH__");v=h._("__JHASH__jLFq-Qn9eN___JHASH__");var B=n(function(){return c("DeletionType.react").Global}),C=B[0],D=B[1],E=function(){t==null?void 0:t(babelHelpers["extends"]({},s.current,{eventName:"message_remove_confirm"}));C===c("DeletionType.react").Global?A(e):z(e);k&&k(C===c("DeletionType.react").Global?c("DeletionType.react").Global:c("DeletionType.react").Local);return g()},F=function(){g(),t==null?void 0:t(babelHelpers["extends"]({},s.current,{eventName:"message_remove_cancel"}))},G=d("MWPActor.react").useActor();B=d("ReQLSuspense").useFirst(function(){return d("LSMessagingThreadTypeUtil").isOneToOne(q)?d("ReQL").mergeJoin(d("ReQL").fromTableAscending(r.tables.participants).getKeyRange(e.threadKey),d("ReQL").fromTableAscending(r.tables.contacts)).filter(function(a){a[0];a=a[1];return!(j||(j=d("I64"))).equal(a.id,G)}):d("ReQL").empty()},[r,e.threadKey,q,G],f.id+":147");B=B!=null?(B=d("LSContactBitOffset").has(64,B[1]))!=null?B:!1:!1;u=u&&B;var H;u?H=null:H=l.jsxs(l.Fragment,{children:[l.jsx(c("MWXRadio.react"),{checked:C===c("DeletionType.react").Global,label:c("gkx")("24122")?h._("__JHASH__3WNPzP2whFB__JHASH__"):h._("__JHASH__Blkrb2PpT4H__JHASH__"),name:"radio",onChange:function(){return D(c("DeletionType.react").Global)},testid:void 0,value:c("DeletionType.react").Global}),l.jsx("div",{className:"xdj266r x1gja9t x1hq5gj4 x8vdgqj",children:l.jsx(c("MWDialogText.react"),{color:"secondary",children:x})})]});var I=l.jsxs(l.Fragment,{children:[l.jsx(c("MWXRadio.react"),{checked:C!==c("DeletionType.react").Global,label:h._("__JHASH__lajVt418Pj8__JHASH__"),name:"radio",onChange:function(){return D(c("DeletionType.react").Local)},testid:void 0,value:c("DeletionType.react").Local}),l.jsx("div",{className:"xdj266r x1gja9t x1hq5gj4 x8vdgqj",children:l.jsx(c("MWDialogText.react"),{color:"secondary",children:w})})]});return b?l.jsx(c("MWXMultiStepDialog.react"),{onClose:F,ref:a,size:"medium",title:v,withCloseButton:!0,children:function(a){return l.jsxs(c("MWXDialogPageLegacy.react"),{primaryCallToAction:{label:h._("__JHASH__hqbvAdrkmFp__JHASH__"),onPress:E,testid:"messenger_global_remove_dialog_submit",type:"primary"},secondaryCallToAction:{label:h._("__JHASH__ddF1YsNwDg4__JHASH__"),onPress:F},children:[H,I,b&&b(a)]})}}):l.jsxs(c("MWXCardedDialog.react"),{onClose:F,primaryCallToAction:{label:h._("__JHASH__hqbvAdrkmFp__JHASH__"),onPress:E,testid:"messenger_global_remove_dialog_submit",type:"primary"},ref:a,secondaryCallToAction:{label:h._("__JHASH__ddF1YsNwDg4__JHASH__"),onPress:F},size:"medium",title:v,withCloseButton:!0,children:[H,I]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2LocalRemoveMessageDialog.react",["fbt","DeletionType.react","LSMessagingThreadTypeUtil","MWDialogText.react","MWXCardedDialog.react","MessengerWebUXLogger","WebUserFlowLoggingDataContextProvider.react","cr:6988","react","useMWV2LocalRemoveMessage"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useContext;e=function(){return function(a){}};var l=b("cr:6988")||e;function a(a){var b=a.message,e=a.onClose,f=a.removeLogger;a=a.threadType;a=d("LSMessagingThreadTypeUtil").isSecure(a);var g=l(),i=c("useMWV2LocalRemoveMessage")(),m=a?g:i;g=k(d("WebUserFlowLoggingDataContextProvider.react").WebUserFlowLoggingDataContext);var n=g.loggingDataRef;i=c("MessengerWebUXLogger").useImpressionLoggerRef(babelHelpers["extends"]({},n.current,{eventName:"message_remove_sheet_rendered"}));var o=c("MessengerWebUXLogger").useInteractionLogger();g=function(){o==null?void 0:o(babelHelpers["extends"]({},n.current,{eventName:"message_remove_confirm"}));m(b);f&&f(c("DeletionType.react").Local);return e()};var p=function(){e(),o==null?void 0:o(babelHelpers["extends"]({},n.current,{eventName:"message_remove_cancel"}))},q=h._("__JHASH__MtviLGqEBTm__JHASH__");return j.jsx(c("MWXCardedDialog.react"),{hasTextOnlyContent:!0,onClose:p,primaryCallToAction:{label:h._("__JHASH__hqbvAdrkmFp__JHASH__"),onPress:g,testid:"messenger_local_remove_dialog_submit"},ref:i,secondaryCallToAction:{label:h._("__JHASH__ddF1YsNwDg4__JHASH__"),onPress:p},size:"small",title:q,withCloseButton:!0,children:j.jsx(c("MWDialogText.react"),{children:a?h._("__JHASH__mgfzRCe5bWP__JHASH__"):h._("__JHASH__-fLc5wOF5_O__JHASH__")})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2RemoveMessageDialog.react",["MWV2GlobalRemoveMessageDialog.react","MWV2LocalRemoveMessageDialog.react","WebUXLoggingSurfaceContextProvider","emptyFunction","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=a.canRemoveMessageGlobally,e=a.learnMoreOnMessageRemove,f=a.message,g=a.onClose;g=g===void 0?c("emptyFunction"):g;var h=a.removeLogger;h=h===void 0?c("emptyFunction"):h;var j=a.threadType;a.title;return i.jsx(d("WebUXLoggingSurfaceContextProvider").WebUXLoggingSurfaceContextProvider,{value:"message_unsend_sheet",children:b?i.jsx(c("MWV2GlobalRemoveMessageDialog.react"),{learnMoreOnMessageRemove:e,message:f,onClose:g,removeLogger:h,threadType:j}):i.jsx(c("MWV2LocalRemoveMessageDialog.react"),{message:f,onClose:g,removeLogger:h,threadType:j})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("useMAWPDeleteMessageForMe",["MAWBridgeSendAndReceive","MAWDbMsg","MAWJobDefinitions","MAWTimedJob","MessengerWebUXLogger","QPLUserFlow","Random","WAJobOrchestratorTypes","WebUserFlowLoggingDataContextProvider.react","promiseDone","qpl","react"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useContext,j=b.useMemo;function a(){var a=i(d("WebUserFlowLoggingDataContextProvider.react").WebUserFlowLoggingDataContext),b=a.loggingDataRef,e=c("MessengerWebUXLogger").useInteractionLogger();return j(function(){return function(a){var f=a.ephemeralDurationInSec,g=a.ephemeralExpirationTs;a=a.messageId;var h=c("qpl")._(25308285,"2002"),i=Date.now()+(Math.round(d("Random").random()*1e4)+1e4);c("QPLUserFlow").start(h,{annotations:{string:{isEphemeralMessage:f!=null||g!=null?"true":"false",type:"secureDeleteMessageForMe"}},instanceKey:i});f=d("MAWDbMsg").toMsgId(a);if(f==null){c("QPLUserFlow").endFailure(h,"missing_msg_id",{instanceKey:i});return}c("promiseDone")(d("MAWBridgeSendAndReceive").sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:f}).then(function(a){if(a==null){e==null?void 0:e(babelHelpers["extends"]({},b.current,{eventName:"message_remove_failure",eventType:"backend",extraData:babelHelpers["extends"]({},b.current.extraData,{error:"missing_msg_id"})}));c("QPLUserFlow").endFailure(h,"missing_protocolMsgId",{instanceKey:i});return}return d("MAWTimedJob").TimedUIJobStarters.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.deleteMsgsForMe([a],{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})).then(function(){e==null?void 0:e(babelHelpers["extends"]({},b.current,{eventName:"message_remove_success",eventType:"backend"})),c("QPLUserFlow").endSuccess(h,{instanceKey:i})})}))}},[e,b])}g["default"]=a}),98);
__d("useMAWPRevokeMessage",["I64","Int64Hooks","MAWBridgeSendAndReceive","MAWDbMsg","MAWJobDefinitions","MAWTimedJob","MWPActor.react","MessengerWebUXLogger","QPLUserFlow","Random","WAJobOrchestratorTypes","WebUserFlowLoggingDataContextProvider.react","promiseDone","qpl","react","requireDeferred","useMWLSDefaultThreadSource","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(j||d("react")).useContext,l=c("requireDeferred")("MWLogSend").__setRef("useMAWPRevokeMessage");function a(a){var b=d("MWPActor.react").useActor(),e=(h||(h=c("useReStore")))(),f=c("useMWLSDefaultThreadSource")(),g=k(d("WebUserFlowLoggingDataContextProvider.react").WebUserFlowLoggingDataContext),j=g.loggingDataRef,m=c("MessengerWebUXLogger").useInteractionLogger();return d("Int64Hooks").useMemoInt64(function(){return function(e){var g=e.ephemeralDurationInSec,h=e.ephemeralExpirationTs,k=e.messageId,n=e.threadKey,o=c("qpl")._(25308285,"2002"),p=Date.now()+(Math.round(d("Random").random()*1e4)+1e4);c("QPLUserFlow").start(o,{annotations:{string:{isEphemeralMessage:g!=null||h!=null?"true":"false",type:"secureUnsendMessage"}},instanceKey:p});e=d("MAWDbMsg").toMsgId(k);if(e==null){m==null?void 0:m(babelHelpers["extends"]({},j.current,{eventName:"message_remove_failure",eventType:"backend",extraData:babelHelpers["extends"]({},j.current.extraData,{error:"missing_msg_id"})}));c("QPLUserFlow").endFailure(o,"missing_msg_id",{instanceKey:p});return}c("promiseDone")(d("MAWBridgeSendAndReceive").sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:e}).then(function(e){if(e==null){m==null?void 0:m(babelHelpers["extends"]({},j.current,{eventName:"message_remove_failure",eventType:"backend",extraData:babelHelpers["extends"]({},j.current.extraData,{error:"missing_protocolMsgId"})}));c("QPLUserFlow").endFailure(o,"missing_protocolMsgId",{instanceKey:p});return}var g=f(n);l.onReady(function(c){var f=(i||(i=d("I64"))).to_string(n);return c.log({actor:b,attachmentFbids:[],attachmentType:26,backend:1,hasReply:!1,messagingThreadId:f,offlineThreadingId:e.externalId,sendType:0,source:g,threadKey:n,threadType:a})});return d("MAWTimedJob").TimedUIJobStarters.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.revokeMsgs([e],{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})).then(function(){m==null?void 0:m(babelHelpers["extends"]({},j.current,{eventName:"message_remove_success",eventType:"backend"})),c("QPLUserFlow").endSuccess(o,{instanceKey:p})})}))}},[e,f,m,j,b,a])}g["default"]=a}),98);